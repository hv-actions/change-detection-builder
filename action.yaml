name: "Change-detection_builder"
description: "Change-detection_builder"

outputs:
  changed_modules:
    description: "Names of modules which got changed"
    value: ${{ steps.python_script.outputs.changed_modules }}

runs:
  using: "composite"
  steps:
  
    - name: Git configuration
      run: git config --global --add safe.directory '*'
      shell: bash  
      
    - name: Get changed files
      id: changes
      shell: bash
      run: |
        changes=$(git diff-tree --no-commit-id --name-only -r ${{ github.sha }} | xargs)
        if [[ -z "$changes" ]]; then
          changes=$(git diff --name-only --diff-filter=ACMRT ${{ github.event.pull_request.base.sha }} ${{ github.sha }} | xargs)
        fi
        echo "all=${changes}"
        echo "all=${changes}" >> $GITHUB_OUTPUT
    
    - name: Python command
      id: python_script
      run: |
        echo "${{ steps.changes.outputs.all }}"
        python3 ${GITHUB_ACTION_PATH}/maven.py \
          "${{ steps.changes.outputs.all }}" \
          "${GITHUB_WORKSPACE}" 
      shell: bash
